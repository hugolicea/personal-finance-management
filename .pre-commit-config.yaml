repos:
    - repo: https://github.com/pre-commit/pre-commit-hooks
      rev: v4.5.0
      hooks:
          - id: trailing-whitespace
          - id: end-of-file-fixer
          - id: check-yaml
          - id: check-added-large-files
            args: ['--maxkb=1000']
          - id: check-json
          - id: check-merge-conflict
          - id: detect-private-key

    # Ruff - replaces black, flake8, and isort
    - repo: https://github.com/astral-sh/ruff-pre-commit
      rev: v0.8.4
      hooks:
          # Linter (replaces flake8 + isort)
          - id: ruff
            args: [--fix, --exit-non-zero-on-fix]
            files: ^backend/
          # Formatter (replaces black)
          - id: ruff-format
            files: ^backend/

    # Prettier - runs from root, works fine
    - repo: https://github.com/pre-commit/mirrors-prettier
      rev: v3.1.0
      hooks:
          - id: prettier
            files: ^frontend/
            types_or: [javascript, jsx, ts, tsx, json, css]

    # Frontend tools - use local hooks to run from correct directory
    - repo: local
      hooks:
          - id: eslint
            name: ESLint
            entry: python -c "import sys, os, subprocess; os.chdir('frontend'); files = [f.replace('frontend/', '').replace('frontend\\\\', '') for f in sys.argv[1:]]; sys.exit(subprocess.call('npx eslint ' + ' '.join(files), shell=True) if files else 0)"
            language: system
            files: ^frontend/src/.*\.[jt]sx?$
            types: [file]

          - id: typescript-check
            name: TypeScript Type Check
            entry: cmd /c "cd frontend && npx tsc --noEmit"
            language: system
            files: ^frontend/.*\.[jt]sx?$
            pass_filenames: false # tsc needs the whole project context
